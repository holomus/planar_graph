<script biruni>
page.require('html2canvas', 'qrcode');
page.init(function(param, xparam, t, $filter) {
  var pq = page.query('table').param(param), formatNumber = $filter('bNumber'), t_no_access = t('no access to wage')();

  if (xparam.where) pq.where(xparam.where);
  else if (param.where) pq.where(param.where);

  if (page.isInit()) pq.filter('status', '<>', 'D');

  function defaultPhoto(gender) {
    return `page/resource/vhr/no_photo_${ gender == 'F'? 'fe': '' }male.png`;
  }

  var pg = page.grid('table');

  pg.asHtml('person_html', 'photo_sha, gender, name', function(row) {
    return `<div><img src="${ !row.photo_sha ? defaultPhoto(row.gender) : page.loadImageSmall(row.photo_sha) }" class="rounded-circle" style="width: 55px; height: 55px; border: 1px solid rgba(230, 230, 240, 0.8); object-fit: cover;"/>&emsp;${ row.name }</div>`;
  });
  pg.asHtml('user_activated_html', 'user_activated, user_activated_name', function(row) {
    return `<div class="d-flex align-items-center justify-content-center h-100">
              <i style="font-size: 16px;" class="${ row.user_activated == 'Y' ? 'fas fa-check-circle text-success' : 'far fa-check-circle text-muted' }"></i>
            </div>`;
  });

  var status_class = { 'W': 'success', 'D': 'danger', 'U': 'warning' };

  pg.asHtml('status_html', 'status, status_name', row => {
    return `<div class="alert alert-custom alert-light-${ status_class[row.status] } text-center py-1 px-3 m-0"><div class="alert-text">${ row.status_name }</div></div>`;
  });
  pg.asHtml('fixed_term_html', 'fixed_term, fixed_term_name', row => {
    return `<div class="alert alert-custom alert-light-${ row.fixed_term == 'Y' ? 'success' : row.fixed_term == 'N' ? 'danger' : '' } text-center py-1 px-3 m-0"><div class="alert-text">${ row.fixed_term_name }</div></div>`;
  });
  pg.asHtml('on_trial_period_html', 'on_trial_period, on_trial_period_name', row => {
    return `<div class="alert alert-custom alert-light-${ row.on_trial_period == 'Y' ? 'success' : row.on_trial_period == 'N' ? 'danger' : '' } text-center py-1 px-3 m-0"><div class="alert-text">${ row.on_trial_period_name }</div></div>`;
  });
  pg.asHtml('photo_html', 'photo_sha, gender', function(row) {
    return `<img src="${ !row.photo_sha ? defaultPhoto(row.gender) : page.loadImageSmall(row.photo_sha) }" class="rounded-circle" style="width: 55px; height: 55px; border: 1px solid rgba(230, 230, 240, 0.8); object-fit: cover;"/>`;
  });
  pg.asHtml('wage_html', 'wage', row => {
    return row.wage == '-1' ? t_no_access : formatNumber(row.wage);
  });

  var document_status_class = { 'C': 'success', 'P': 'danger', 'E': 'secondary' };

  pg.asHtml('person_document_owe_status_html', 'person_document_owe_status, person_document_owe_status_name, person_documents_count, required_doc_types_count', row => {
    if (row.required_doc_types_count == 0) {
      return `<span class="badge badge-${ document_status_class[row.person_document_owe_status] }">${ row.person_document_owe_status_name }</span>`;
    }
    return `<span class="badge badge-${ document_status_class[row.person_document_owe_status] }">${ row.person_document_owe_status_name } ${ row.person_documents_count }/${ row.required_doc_types_count }</span>`;
  });
});
page.ctrl(function(scope, fi, t, model, xparam, bConfig, bRequire, bContentMaker, $q, $timeout, AppSession) {
  var q = _.extend(model, { checked: {} }),
      p = { data: {} };

  function selectOne(row) {
    q.multiple_select ? page.close([row]) : page.close(row);
  }

  function selectMany() {
    page.close(q.checked.rows());
  }

  function closeIfDialog(result) {
    if (page.isDialog()) selectOne(result);
  }

  function add() {
    fi.add(null, closeIfDialog);
  }

  function view(row) {
    fi.view({ employee_id: row.employee_id });
  }

  function importStartData() {
    fi.import_start(null, closeIfDialog);
  }

  function importProData() {
    fi.import_pro(null, closeIfDialog);
  }

  function attachEmployee() {
    fi.attach(null, closeIfDialog);
  }

  function doAction(action, message, employee_id, state) {
    page.confirm(message, function() {
      let data = { employee_id: employee_id };
      if (state) data.state = state;
      action(data).then(page.reload, page.alert);
    });
  }

  function doActionOne(action, confirmFunc, state) {
    return function(row) {
      doAction(action, confirmFunc(row.name), row.employee_id, state);
    };
  }

  function doActionMany(action, confirmFunc, key, state) {
    return function() {
      doAction(action, confirmFunc(q[key].size), _.pluck(q[key].rows, 'employee_id'), state);
    };
  }

  function onDblclick(row) {
    page.isDialog() ? selectOne(row): fi.view ? view(row) : null;
  }

  // badge
  var modal = page.$content.find("form[name='modal']>.modal");
  var qrcode = new QRCode(modal.find('.employee-qrcode')[0], { width: 200, height: 200 });
  var qrcodeImage = $(qrcode._el).find('img')[0];
  var contentMaker = new bContentMaker();
  var downloadQrcodeElem = modal.find('.employee-qrcode');

  q.filial_photo_src = q.filial_photo_sha ? page.loadImageMedium(q.filial_photo_sha) : 'page/resource/core/no_image.png';

  function showModal(row) {
    if (row) p.employee_name = row.name;
    $timeout(function() {
      modal.modal('show');
    });
  }

  function hideModal() {
    modal.modal('hide');
  }

  // modalOrgUnit
  var modalOrgUnit = page.$content.find("form[name='modalOrgUnit']>.modal");

  function showModalOrgUnit() {
    $timeout(function() {
      modalOrgUnit.modal('show');
    });
  }

  function hideModalOrgUnit() {
    modalOrgUnit.modal('hide');
  }

  function openOrgUnit(row) {
    var data = _.pick(row, 'staff_id', 'division_id', 'org_unit_id', 'division_name');

    if (q.org_units[row.division_id] == null) {
     page.post(':get_org_units', { division_id: row.division_id }).then(result => {
        q.org_units[row.division_id] = _.mapRows(result.org_units, ['org_unit_id', 'name', 'parent_id']);
        p.data.org_units = q.org_units[row.division_id];

        _.extend(p.data, data);
        showModalOrgUnit();
      }, page.alert);
    } else {
      p.data.org_units = q.org_units[row.division_id];

      _.extend(p.data, data)
      showModalOrgUnit();
    }
  }

  function updateOrgUnit() {
    var data = {
      staff_id: p.data.staff_id,
      org_unit_id: p.data.org_unit_id
    };

    fi.edit_org_unit(data).then(page.grid('table').fetch(), page.alert);
    hideModalOrgUnit();
  }

  function defaultPhoto(gender) {
    var res = gender == 'F' ? 'fe' : '';
    return 'page/resource/vhr/no_photo_' + res + 'male.png';
  }

  function getQrcode(key) {
    return $q(function(resolve, reject) {
      qrcode.makeCode(key);
      qrcodeImage.onload = function() {
        resolve(qrcodeImage.src);
      };
    });
  }

  async function genBadge(badge, badge_size_class) {
    var unique_key = window.location.origin + window.location.pathname + 'page/form/vhr/public/employee_card.html?filial_id=' + AppSession.si.filial.id + '&employee_code=' + badge.qr_code;

    return getQrcode(unique_key).then(function(result) {
      let data = {
        company_name: q.company_name,
        filial_name: AppSession.si.filial.name,
        filial_logo: q.filial_photo_src,
        employee_name: badge.name,
        employee_number: badge.employee_number,
        employee_job: badge.job_name,
        employee_rank: badge.rank_name,
        employee_division: badge.division_name,
        employee_photo: badge.photo_sha ? page.loadImageMedium(badge.photo_sha) : defaultPhoto(badge.gender),
        qrcode: result
      };

      return contentMaker.render(q.badge_template_value, data).then(function(result) {
        downloadQrcodeElem.append(`<div class="form-group ${badge_size_class}">${result}</div>`);
      });
    });
  }

  async function genBadges(badges, badge_size_class) {
    downloadQrcodeElem.empty();
    for(let i = 0; i < badges.length; i ++) {
      try {
        await genBadge(badges[i], badge_size_class);
      } catch (err) {
        console.error("error generate employee badge");
      }
    }
  }

  function openDownloadBadges(rows) {
    q.badges = rows;
    q.badge_multiple = rows.length > 1;

    genBadges([...q.badges], q.badge_multiple ? 'col-sm-12' : 'col-sm');
    q.badge_multiple ?  showModal() : showModal(rows[0]);
  }

  function downloadBadges(employeeName) {
    html2canvas(page.$content.find('.dwnld')[0], {
      scale: 4,
      imageTimeout: 2000,
      removeContainer: true
    }).then(function(canvas) {
      var image = canvas.toDataURL('image/jpeg');
      var link = document.createElement('a');
      link.download = q.badge_multiple ? t('Emloyees Badges')() : employeeName + '.jpeg';
      link.href = image;
      link.click();
    });
  }

  // report
  function report(row, rep, rt) {
    if (!row.staff_id) return;
    var data = {
      staff_ids: [row.staff_id],
      rt: rt
    };

    var auths = bConfig.auths();
    _.each(auths, function(val, key) {
      data['-' + key] = val;
    });

    window.open('b' + rep.uri + '?' + $.param(_.defaults({}, data, auths), true));
  }

  function reportSettings(form) {
    page.openDialog(form, { open_setting: 'Y' });
  }

  // check
  function prepareChecked(key, checked, filterFunc) {
    q[key] = {};
    q[key].rows = _.filter(checked.rows(), filterFunc);
    q[key].size = q[key].rows.length;
    q[key].has = q[key].size > 0;
  }

  function editOrgUnit(row) {
    return q.position_enable == 'N' && q.advanced_org_structure == 'Y' && fi.edit_org_unit && row.division_id;
  }

  // schedule change
  var modalScheduleChange = page.$content.find("form[name='modalScheduleChange']>.modal");

  function openScheduleChangeModal(row) {
    p.schedule_change = angular.copy({
      staff_id: _.pluck(row, 'staff_id'),
      begin_date: moment().format('DD.MM.YYYY')
    });

    $timeout(function() {
      page.untouch(scope.modalScheduleChange);
      modalScheduleChange.modal('show');
    });
  }

  function scheduleChange() {
    if (!page.valid(scope.modalScheduleChange)) return;

    fi.schedule_change(_.omit(p.schedule_change, 'schedule_name')).then(() => {
      page.grid('table').fetch();
      q.to_get_badge = {};
      q.to_schedule_change = {};
      q.checked = {};

      $timeout(function() {
        modalScheduleChange.modal('hide');
      });
    }, page.alert);
  }

  // schedule
  function setSchedule(row) {
    if (!row) return;
    p.schedule_change.schedule_id = row.schedule_id;
    p.schedule_change.schedule_name = row.name;
  }

  function addSchedule(name) {
    fi.add_schedule({ schedule_kind: 'F' }, setSchedule, { name: name });
  }

  function selectSchedule() {
    fi.select_schedule(null, setSchedule);
  }

  function onCheck(checked) {
    q.checked = checked;
    prepareChecked('to_get_badge', checked, x => x.qr_code);
    prepareChecked('to_activate_employee', checked, x => x.employee_activated == 'N');
    prepareChecked('to_deactivate_employee', checked, x => x.employee_activated == 'Y');
    prepareChecked('to_block_employee_tracking', checked, x => x.is_tracking_blocked == 'N');
    prepareChecked('to_unblock_employee_tracking', checked, x => x.is_tracking_blocked == 'Y');
    prepareChecked('to_activate_user', checked, x => x.user_activated == 'N');
    prepareChecked('to_deactivate_user', checked, x => x.user_activated == 'Y');
    prepareChecked('to_delete', checked, x => !x.staff_id);
    prepareChecked('to_schedule_change', checked, x => x.status == 'W');
  }

  var sc = [ // success
    { grant: fi.add, fn: add },
    { grant: fi.attach, fn: attachEmployee },
    { grant: fi.import_pro, fn: importProData },
    { grant: fi.import_start, fn: importStartData },
  ];

  q.sc = {};
  q.org_units = {};
  q.sc.acc = _.filter(sc, x => x.grant);
  q.sc.length = q.sc.acc.length;
  if (q.sc.length > 0) {
    q.sc.firstFn = q.sc.acc[0].fn;
    q.sc.first = q.sc.acc[0].grant;
  }

  q.multiple_select = xparam.multiple_select;
  q.reports = _.mapRows(model.reports, ['uri', 'name', 'form']);

  scope.q = q;
  scope.p = p;

  scope.deleteOne = doActionOne(fi.delete, t('delete employee $1{employee_name}?'));
  scope.deleteMany = doActionMany(fi.delete, t('delete $1{employee_count} employee(s)?'), 'to_delete');

  scope.activateEmployeeOne = doActionOne(fi.change_employee_activation, t('activate employee $1{employee_name}?'), 'A');
  scope.activateEmployeeMany = doActionMany(fi.change_employee_activation, t('activate $1{employee_count} employee(s)?'), 'to_activate_employee', 'A');

  scope.deactivateEmployeeOne = doActionOne(fi.change_employee_activation, t('deactivate employee $1{employee_name}?'), 'P');
  scope.deactivateEmployeeMany = doActionMany(fi.change_employee_activation, t('deactivate $1{employee_count} employee(s)?'), 'to_deactivate_employee', 'P');

  scope.blockEmployeeTrackingOne = doActionOne(fi.block_employee_tracking, t('block tracking for employee $1{employee_name}?'), 'A');
  scope.blockEmployeeTrackingMany = doActionMany(fi.block_employee_tracking, t('block tracking for $1{employee_count} employee(s)?'), 'to_block_employee_tracking', 'A');

  scope.unblockEmployeeTrackingOne = doActionOne(fi.unblock_employee_tracking, t('unblock tracking for employee $1{employee_name}?'), 'P');
  scope.blockEmployeeTrackingMany = doActionMany(fi.unblock_employee_tracking, t('unblock tracking for $1{employee_count} employee(s)?'), 'to_unblock_employee_tracking', 'P');

  scope.activateUserOne = doActionOne(fi.change_user_activation, t('activate user $1{user_name}?'), 'A');
  scope.activateUserMany = doActionMany(fi.change_user_activation, t('activate $1{user_count} user(s)?'), 'to_activate_user', 'A');

  scope.deactivateUserOne = doActionOne(fi.change_user_activation, t('deactivate user $1{user_name}?'), 'P');
  scope.deactivateUserMany = doActionMany(fi.change_user_activation, t('deactivate $1{user_count} user(s)?'), 'to_deactivate_user', 'P');
});
</script>
<div class="b-toolbar row">
  <div class="col-sm-14">
    <div class="btn-group">
      <button type="button" class="btn btn-success" ng-click="q.sc.firstFn()" ng-if="q.sc.first" b-hotkey="add">{{ q.sc.first.title }}</button>
      <button type="button" class="btn btn-success dropdown-toggle" ng-if="q.sc.length > 1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
      <div class="dropdown-menu" ng-if="q.sc.length > 1">
        <a href class="dropdown-item" ng-repeat="acc in q.sc.acc | limitTo: (1 - q.sc.length)" ng-click="acc.fn()" ng-if="acc.grant">{{ acc.grant.title }}</a>
      </div>
    </div>
    <button type="button" class="btn btn-primary" ng-click="selectMany()" ng-if="page.isDialog() && q.multiple_select" ng-show="q.checked.has">
      <t p1="q.checked.size">select $1</t>
    </button>
    <div class="btn-group" ng-if="fi.change_employee_activation || fi.change_user_activation" ng-show="q.checked.has">
      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" ><t>change activation</t></button>
      <div class="dropdown-menu">
        <a class="dropdown-item cursor-pointer" ng-click="activateEmployeeMany()" ng-if="fi.change_employee_activation" ng-show="q.to_activate_employee.has"><t p1="q.to_activate_employee.size">activate employee $1</t></a>
        <a class="dropdown-item cursor-pointer" ng-click="deactivateEmployeeMany()" ng-if="fi.change_employee_activation" ng-show="q.to_deactivate_employee.has"><t p1="q.to_deactivate_employee.size">deactivate employee $1</t></a>

        <a class="dropdown-item cursor-pointer" ng-click="blockEmployeeTrackingMany()" ng-if="fi.block_employee_tracking" ng-show="q.to_block_employee_tracking.has"><t p1="q.to_block_employee_tracking.size">block tracking for employee $1</t></a>
        <a class="dropdown-item cursor-pointer" ng-click="blockEmployeeTrackingMany()" ng-if="fi.unblock_employee_tracking" ng-show="q.to_unblock_employee_tracking.has"><t p1="q.to_unblock_employee_tracking.size">unblock tracking for employee $1</t></a>

        <a class="dropdown-item cursor-pointer" ng-click="activateUserMany()" ng-if="fi.change_user_activation" ng-show="q.to_activate_user.has"><t p1="q.to_activate_user.size">activate user $1</t></a>
        <a class="dropdown-item cursor-pointer" ng-click="deactivateUserMany()" ng-if="fi.change_user_activation" ng-show="q.to_deactivate_user.has"><t p1="q.to_deactivate_user.size">deactivate user $1</t></a>
        <a class="dropdown-item cursor-pointer" ng-click="openScheduleChangeModal(q.to_schedule_change.rows)" ng-if="fi.schedule_change && q.is_pro == 'N'" ng-show="q.to_schedule_change.has"><t p1=q.to_schedule_change.size>schedule change for $1 employees</t></a>
      </div>
    </div>
    <button type="button" class="btn btn-danger" ng-click="deleteMany()" ng-if="fi.delete && q.access_all_employee == 'Y'" ng-show="q.to_delete.has">
      <t p1="q.to_delete.size">delete $1</t>
    </button>
    <button type="button" class="btn btn-primary" ng-show="q.to_get_badge.has && q.badge_template_value" ng-click="openDownloadBadges(q.to_get_badge.rows)">
      <t p1=q.to_get_badge.size>download $1 badge(s)</t>
    </button>
    <button type="button" class="btn btn-default" ng-click="page.close()" ng-hide="page.isFirst()" b-hotkey="close">{{ page.close.title }}</button>
  </div>
  <div class="col-sm-10 b-right">
    <b-grid-controller name="table"/>
  </div>
</div>
<div class="b-content">
  <form name="form">
    <b-grid name="table" required="employee_id, name, staff_id, qr_code, job_name, rank_name, division_name, division_id, org_unit_id, gender, photo_sha, employee_activated, user_activated, status, is_tracking_blocked" on-check="onCheck(checked)" on-dblclick="onDblclick(row)"
            sort="name" search="name, employee_number, passport_info" searchable="employee_id, npin, tin, main_phone, email, region_name, code, robot_name"
            extra-columns="employee_id, employee_number, last_name, first_name, middle_name, gender_name, birthday, age, nationality_name, tin, extra_phone, corporate_email, iapa, npin, email, address, legal_address, region_name, code,
                           hiring_date, dismissal_date, dismissal_reason_name, dismissal_note, location_names, edu_stage_names, institution_names, specialty_names, access_level_name, login,
                           oper_type_names, wage_scale_name, robot_name, created_by_name, created_on, modified_by_name, modified_on, face_reg_photos_exist_name, fprint_exist_name, employee_activated_name, fte_name, rank_name, passport_info, expiry_date, org_unit_name, pin,
                           employment_type_name, is_tracking_blocked_name">
      <b-row>
        <b-col name="employee_number" size=2/>
        <b-col name="name" as-html="person_html" size=5/>
        <b-col name="manager_name" size=4/>
        <b-col name="division_name" size=3/>
        <b-col name="job_name" size=3/>
        <b-col name="schedule_name" size=3/>
        <b-col name="main_phone" size=3/>
      </b-row>

      <b-extra-columns>
        <b-col name="user_activated_name" as-html="user_activated_html"/>
        <b-col name="status_name" as-html="status_html"/>
        <b-col name="fixed_term_name" as-html="fixed_term_html"/>
        <b-col name="on_trial_period_name" as-html="on_trial_period_html"/>
        <b-col name="wage" as-html="wage_html" format="amount"/>
        <b-col name="photo_sha" as-html="photo_html" img="100;100"/>
        <b-col name="person_document_owe_status" as-html="person_document_owe_status_html"/>
      </b-extra-columns>

      <b-action>
        <button type="button" class="btn btn-default" ng-click="selectOne(row)" ng-if="page.isDialog()"><t>select</t></button>
        <button type="button" class="btn btn-default" ng-click="view(row)" ng-if="fi.view">{{ fi.view.title }}</button>
        <div class="btn-group" ng-if="fi.change_employee_activation || fi.change_user_activation">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-dblclick="$event.stopPropagation();"><t>change activation</t></button>
          <div class="dropdown-menu" style="cursor: pointer;">
            <a class="dropdown-item" ng-click="activateEmployeeOne(row)" ng-if="fi.change_employee_activation" ng-show="row.employee_activated == 'N'"><t>activate employee</t></a>
            <a class="dropdown-item" ng-click="deactivateEmployeeOne(row)" ng-if="fi.change_employee_activation" ng-show="row.employee_activated == 'Y'"><t>deactivate employee</t></a>
            <a class="dropdown-item" ng-click="blockEmployeeTrackingOne(row)" ng-if="fi.block_employee_tracking" ng-show="row.is_tracking_blocked == 'N'"><t>block employee tracking</t></a>
            <a class="dropdown-item" ng-click="unblockEmployeeTrackingOne(row)" ng-if="fi.unblock_employee_tracking" ng-show="row.is_tracking_blocked == 'Y'"><t>unblock employee tracking</t></a>
            <a class="dropdown-item" ng-click="activateUserOne(row)" ng-if="fi.change_user_activation" ng-show="row.user_activated == 'N'"><t>activate user</t></a>
            <a class="dropdown-item" ng-click="deactivateUserOne(row)" ng-if="fi.change_user_activation" ng-show="row.user_activated == 'Y'"><t>deactivate user</t></a>
          </div>
        </div>
        <button type="button" class="btn btn-default" ng-click="deleteOne(row)" ng-if="fi.delete && q.access_all_employee == 'Y' && !row.staff_id">{{ fi.delete.title }}</button>
        <div class="btn-group" ng-if="q.reports.length > 0 && row.staff_id">
          <button type="button" class="btn btn-default dropdown-toggle" ng-dblclick="$event.stopPropagation();" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <t>report</t>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li ng-repeat="r in q.reports" ng-click="report(row, r, 'html')">
              <a class="dropdown-item">
                <button type="button" class="btn btn-icon btn-default" ng-click="$event.stopPropagation();reportSettings(r.form)">
                  <i class="fas fa-cog"></i>
                </button>&nbsp;
                <button type="button" class="btn btn-icon btn-default" ng-click="$event.stopPropagation();report(row, r, 'xlsx')">
                  <i class="far fa-file-excel mb-1"></i>
                </button>&emsp;
                <span class="my-auto" ng-click="$event.stopPropagation();report(row, r, 'html')">{{ r.name }}</span>
              </a>
            </li>
          </ul>
        </div>
        <button type="button" class="btn btn-default" ng-click="openDownloadBadges([row])" ng-if="q.badge_template_value && row.qr_code"><t>employee badge</t></button>
        <button type="button" class="btn btn-default" ng-click="openScheduleChangeModal([row])" ng-if="row.status == 'W' && fi.schedule_change && q.is_pro == 'N'"><t>schedule change</t></button>
        <button type="button" class="btn btn-default" ng-click="openOrgUnit(row)" ng-if="editOrgUnit(row)">{{ fi.edit_org_unit.title }}</button>
      </b-action>

      <b-filter name="employee_id" directive="equal" extra/>
      <b-filter name="employee_number"/>
      <b-filter name="name"/>
      <b-filter name="manager_id" decorate-with="manager_name"/>
      <b-filter name="division_id" decorate-with="division_name" tree-with-parent="parent_id"/>
      <b-filter name="job_id" decorate-with="job_name"/>
      <b-filter name="schedule_id" decorate-with="schedule_name"/>
      <b-filter name="hiring_date"/>
      <b-filter name="gender" decorate-with="gender_name"/>
      <b-filter name="birthday"/>
      <b-filter name="region_id" decorate-with="region_name"/>
      <b-filter name="main_phone"/>
      <b-filter name="employee_activated" decorate-with="employee_activated_name"/>
      <b-filter name="user_activated" decorate-with="user_activated_name"/>
      <b-filter name="status" decorate-with="status_name"/>
      <b-filter name="person_document_owe_status" decorate-with="person_document_owe_status_name"/>
      <b-filter name="employment_type" decorate-with="employment_type_name" extra/>
      <b-filter name="fte_id" decorate-with="fte_name" extra/>
      <b-filter name="org_unit_id" decorate-with="org_unit_name" tree-with-parent="parent_id" extra/>
      <b-filter name="age" extra/>
      <b-filter name="dismissal_date" extra/>
      <b-filter name="dismissal_reason_id" decorate-with="dismissal_reason_name" extra/>
      <b-filter name="wage_scale_id" decorate-with="wage_scale_name" extra/>
      <b-filter name="last_name" extra/>
      <b-filter name="first_name" extra/>
      <b-filter name="middle_name" extra/>
      <b-filter name="nationality_id" decorate-with="nationality_name" extra/>
      <b-filter name="extra_phone" extra/>
      <b-filter name="corporate_email" extra/>
      <b-filter name="email" extra/>
      <b-filter name="legal_address" extra/>
      <b-filter name="access_level" decorate-with="access_level_name" extra/>
      <b-filter name="login" extra/>
      <b-filter name="oper_type_ids" decorate-with="oper_type_names" extra/>
      <b-filter name="robot_id" decorate-with="robot_name" extra/>
      <b-filter name="location_ids" decorate-with="location_names" extra/>
      <b-filter name="edu_stage_ids" decorate-with="edu_stage_names" extra/>
      <b-filter name="rank_id" decorate-with="rank_name" extra/>
      <b-filter name="institution_ids" decorate-with="institution_names" extra/>
      <b-filter name="specialty_ids" decorate-with="specialty_names" extra/>
      <b-filter name="face_reg_photos_exist" decorate-with="face_reg_photos_exist_name" extra/>
      <b-filter name="fprint_exist" decorate-with="fprint_exist_name" extra/>
      <b-filter name="fixed_term" decorate-with="fixed_term_name" extra/>
      <b-filter name="on_trial_period" decorate-with="on_trial_period_name" extra/>
      <b-filter name="is_tracking_blocked" decorate-with="is_tracking_blocked_name" extra/>
      <b-filter name="expiry_date" extra/>
      <b-filter name="pin" extra/>
      <b-filter name="created_by" decorate-with="created_by_name" extra/>
      <b-filter name="created_on" extra/>
      <b-filter name="modified_by" decorate-with="modified_by_name" extra/>
      <b-filter name="modified_on" extra/>
    </b-grid>
  </form>
  <form name="modal">
    <div class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" ng-style="q.badge_multiple ? {'max-width': '1000px'} : ''">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><t>badge modal</t></h5>
            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times"></i></button>
          </div>
          <div class="modal-body">
            <div class="dwnld flex-row d-flex align-content-start flex-wrap">
              <div class="employee-qrcode form-row w-100" style="display: flex; flex-wrap: wrap;"></div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" ng-click="downloadBadges(p.employee_name)"><t>download</t></button>
            <button type="button" class="btn btn-default" data-dismiss="modal"><t>close</t></button>
          </div>
        </div>
      </div>
    </div>
  </form>
  <form name="modalOrgUnit">
    <div class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><t>edit org unit</t></h5>
            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times"></i></button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label><t>division name</t></label>
              <span class="form-view">{{ p.data.division_name }}</span>
            </div>
            <div class="form-group">
              <label><t>org unit name</t></label>
              <b-tree-select
                origin="p.data.org_units"
                id-key="org_unit_id"
                model="p.data.org_unit_id"/>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" ng-click="updateOrgUnit()"><t>save</t></button>
            <button type="button" class="btn btn-default" data-dismiss="modal"><t>close</t></button>
          </div>
        </div>
      </div>
    </div>
  </form>
  <form name="modalScheduleChange">
    <div class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><t>schedule change</t></h5>
            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times"></i></button>
          </div>
          <div class="modal-body">
            <div class="form-row mb-4">
              <div class="col-sm-12 mb-sm-0 mb-4">
                <label><t>begin date</t><r/></label>
                <input type="text" class="form-control" ng-model="p.schedule_change.begin_date" b-date-picker required/>
              </div>
              <div class="col-sm-12 mb-sm-0 mb-4">
                <label><t>end date</t></label>
                <input type="text" class="form-control" ng-model="p.schedule_change.end_date" b-date-picker min-date="p.schedule_change.begin_date"/>
              </div>
            </div>
            <div class="form-group">
              <label><t>schedule</t><r/></label>
              <b-input name="schedules"
                       model="p.schedule_change.schedule_name | name"
                       model-key="p.schedule_change.schedule_id | schedule_id"
                       is-add="fi.add_schedule"
                       on-add="addSchedule(value)"
                       is-view="fi.select_schedule"
                       on-view="selectSchedule()"
                       required-key>
                  {{ row.name }}
              </b-input>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" ng-click="scheduleChange()"><t>save</t></button>
            <button type="button" class="btn btn-default" data-dismiss="modal"><t>close</t></button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>